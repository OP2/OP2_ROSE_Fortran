\clearpage
\section{Function Calls}
Adding functions calls is a typical task for instrumentation translator. 
\begin{itemize}
\item Figure~\ref{Tutorial:exampleInstrumentationTranslator} shows the use of
the AST string based rewrite mechanism to add function calls to the top and bottom of 
each block within the AST.

\item Figure~\ref{Tutorial:exampleAddFunctionCalls} shows the use of
the AST builder interface to do the same instrumentation work.
\end{itemize}
   Figure~\ref{Tutorial:exampleInputCode_InstrumentationTranslator} shows the
input code used to get the translator.
Figure~\ref{Tutorial:exampleOutput_InstrumentationTranslator} shows the resulting output.

Another example shows how to add a function call at the end of each
function body. A utility function, \textit{instrumentEndOfFunction()}, from SageInterface name space is used. 
The interface tries to locate all return statements of a target function 
 and rewriting return expressions with side effects, if there are any. 
 Figure~\ref{Tutorial:instrumentEndOfFunction} shows the translator code. 
 Figure~\ref{Tutorial:inputCode_instrumentEndOfFunction} shows the input
 code. The instrumented code is shown in
 Figure~\ref{Tutorial:rose_inputCode_instrumentEndOfFunction}.

 
%\fixme{Consider making subsections for this section, so that we can present the high-level
%       and mid-level AST rewrite mechanisms. Fix input example to work correctly with
%       functions returning values (this should work).}
%----------------------- translator--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize


% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/instrumentationExample.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/instrumentationExample.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example source code to instrument any input program.}
\label{Tutorial:exampleInstrumentationTranslator}
\end{figure}
%----------------------- translator 2--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize


% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/addFunctionCalls.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/addFunctionCalls.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example source code using the high level interfaces}
\label{Tutorial:exampleAddFunctionCalls}
\end{figure}


%----------------------- input code--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize


% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/inputCode_InstrumentationTranslator.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/inputCode_InstrumentationTranslator.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example source code used as input to instrumenting translator.}
\label{Tutorial:exampleInputCode_InstrumentationTranslator}
\end{figure}

%----------------------- output code--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize


% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleBuildDirectory/rose_inputCode_InstrumentationTranslator.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleBuildDirectory/rose_inputCode_InstrumentationTranslator.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}


\caption{Output of input to instrumenting translator.}
\label{Tutorial:exampleOutput_InstrumentationTranslator}
\end{figure}


%------------------end of function example
%----------------------- translator 3--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize

% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/instrumentEndOfFunction.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/instrumentEndOfFunction.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example source code instrumenting end of functions}
\label{Tutorial:instrumentEndOfFunction}
\end{figure}


%----------------------- input code 3--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize

% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleDirectory/inputCode_instrumentEndOfFunction.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleDirectory/inputCode_instrumentEndOfFunction.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}
\caption{Example input code of the instrumenting translator for end of
functions.}
\label{Tutorial:inputCode_instrumentEndOfFunction}
\end{figure}

%----------------------- output code--------------------------       
\begin{figure}[!ht]
{\indent
{\mySmallFontSize


% Do this when processing latex to generate non-html (not using latex2html)
\begin{latexonly}
   \lstinputlisting{\TutorialExampleBuildDirectory/rose_inputCode_instrumentEndOfFunction.C}
\end{latexonly}

% Do this when processing latex to build html (using latex2html)
\begin{htmlonly}
   \verbatiminput{\TutorialExampleBuildDirectory/rose_inputCode_instrumentEndOfFunction.C}
\end{htmlonly}

% end of scope in font size
}
% End of scope in indentation
}

\caption{Output of instrumenting translator for end of functions.}
\label{Tutorial:rose_inputCode_instrumentEndOfFunction}
\end{figure}

